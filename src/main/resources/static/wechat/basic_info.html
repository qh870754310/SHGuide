<!DOCTYPE html>
<html lang="en" xmlns:v-bind="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>基本信息</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="black" name="apple-mobile-web-app-status-bar-style"/>
    <meta content="telephone=no" name="format-detection"/>
    <!-- 引入样式 -->
    <link rel="stylesheet" href="../resources/path/build/plugins/vue-ydui/dist/ydui.rem.css">
    <!-- 引入rem自适应类库 -->
    <link rel="stylesheet" href="../resources/path/build/plugins/ydui-0.1.3/build/css/ydui.css?rev=a4b9d6e8c9c1cae7ea4676f911682af7"/>
    <link rel="stylesheet" href="../resources/path/build/plugins/ydui-0.1.3/demo/css/demo.css"/>
    <script src="../resources/path/build/plugins/ydui-0.1.3/build/js/ydui.flexible.js"></script>
    <script src="../resources/path/build/js/vue.min.js"></script>
    <style>
        .cell-icon {
            color: red;
            margin-right: 0.1rem;
        }
        .cell-input {
            text-align: center;
        }
        .cell-select {
            color: #555;
        }
        /*#nativePlace {
            display:block;
            width:100%;
            height:44px;
            line-height: 44px;
            border:none;
            border-bottom:1px solid #dae1e7;
            padding:0 10px;
            font-size:14px;
        }*/
    </style>
</head>
<body>
<section class="g-flexview">

    <header class="m-navbar">
        <a href="personinfo.html" class="navbar-item"><i class="back-ico"></i></a>
        <div class="navbar-center"><span class="navbar-title">基本信息</span></div>
    </header>

    <section class="g-scrollview" id="rrapp" v-cloak>
        <div class="m-celltitle demo-small-pitch">系统已存在信息</div>
        <form class="form-horizontal">
        <div class="m-cell demo-small-pitch">
            <div class="cell-item">
                <div class="cell-left">学号：</div>
                <div class="cell-right">
                    <input type="text" v-model="shStudent.studentNo" class="cell-input" readonly autocomplete="off" />
                </div>
            </div>

            <div class="cell-item">
                <div class="cell-left">姓名：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.name" class="cell-input" readonly autocomplete="off" /></div>
            </div>

            <div class="cell-item">
                <div class="cell-left">性别：</div>
                <label class="cell-right cell-arrow">
                    <select class="cell-select" v-model="shStudent.sex" id="sex_Id"></select>
                </label>
            </div>

            <div class="cell-item">
                <div class="cell-left">出生日期：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.birthday" id="birthday" class="cell-input" value="2018-07-15" readonly="readonly" autocomplete="off" /></div>
            </div>

            <div class="cell-item">
                <div class="cell-left">证件类型：</div>
                <label class="cell-right cell-arrow">
                    <select class="cell-select" v-model="shStudent.certificateType" id="certificate_type_Id"></select>
                </label>
            </div>

            <div class="cell-item">
                <div class="cell-left">证件号：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.idCard" class="cell-input" readonly autocomplete="off" /></div>
            </div>

            <div class="cell-item">
                <div class="cell-left">一卡通号：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.metroCard" class="cell-input" autocomplete="off" /></div>
            </div>

            <div class="cell-item">
                <div class="cell-left"><i class="cell-icon">*</i>手机卡号：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.mobileno" class="cell-input" autocomplete="off" required/></div>
            </div>

            <div class="cell-item">
                <div class="cell-left">考生号：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.candidateNo" class="cell-input" autocomplete="off" readonly/></div>
            </div>

            <div class="cell-item">
                <div class="cell-left">准考证号：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.ticketNo" class="cell-input" autocomplete="off" /></div>
            </div>

            <div class="cell-item">
                <div class="cell-left">生源地：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.localInstitution" class="cell-input" autocomplete="off" readonly /></div>
            </div>

            <div class="cell-item">
                <div class="cell-left">籍贯：</div>
                <div class="cell-right cell-arrow">
                    <input type="text" id="nativePlace" v-model="shStudent.nativePlace" class="cell-input" readonly />
                </div>
            </div>

            <div class="cell-item">
                <div class="cell-left">入团时间：</div>
                <div class="cell-right">
                    <input type="date" v-model="shStudent.leagueTime" id="leagueTime" class="cell-input" autocomplete="off" />
                </div>
            </div>

            <div class="cell-item">
                <div class="cell-left">入党时间：</div>
                <div class="cell-right"><input type="date" v-model="shStudent.partyTime" id="partyTime" class="cell-input" autocomplete="off" /></div>
            </div>

            <div class="cell-item">
                <div class="cell-left">婚姻状况：</div>
                <label class="cell-right cell-arrow" >
                    <select class="cell-select" v-model="shStudent.maritalStatus" id="marital_status_Id">

                    </select>
                </label>
            </div>

            <div class="cell-item">
                <div class="cell-left"><i class="cell-icon">*</i>身高(cm)：</div>
                <div class="cell-right"><input type="number" v-model="shStudent.height" class="cell-input" autocomplete="off" required/></div>
            </div>

            <div class="cell-item">
                <div class="cell-left"><i class="cell-icon">*</i>体重(kg)：</div>
                <div class="cell-right"><input type="number" v-model="shStudent.weight" class="cell-input" autocomplete="off" required/></div>
            </div>

            <div class="cell-item">
                <div class="cell-left">民族：</div>
                <label class="cell-right cell-arrow" >
                    <select class="cell-select" v-model="shStudent.nation" id="nation_Id">

                    </select>
                </label>
            </div>

            <div class="cell-item">
                <div class="cell-left">政治面貌：</div>
                <label class="cell-right cell-arrow" >
                    <select class="cell-select" v-model="shStudent.politicalStatus" id="policital_status_Id">

                    </select>
                </label>
            </div>

            <div class="cell-item">
                <div class="cell-left">来源国别：</div>
                <label class="cell-right cell-arrow" >
                    <select class="cell-select" v-model="shStudent.sourceCountry" id="source_country_Id">

                    </select>
                </label>
            </div>

            <div class="cell-item">
                <div class="cell-left">户口所在省：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.registeredProvince" id="province" class="cell-input" autocomplete="off" /></div>
            </div>

            <div class="cell-item">
                <div class="cell-left"><i class="cell-icon">*</i>户口所在市：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.registeredCity" class="cell-input" autocomplete="off" required/></div>
            </div>

            <div class="cell-item">
                <div class="cell-left"><i class="cell-icon">*</i>户口所在县：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.registeredCounty" class="cell-input" autocomplete="off" required/></div>
            </div>

            <div class="cell-item">
                <div class="cell-left">户口所在地：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.domicilePlace" class="cell-input" autocomplete="off" /></div>
            </div>

            <div class="cell-item">
                <div class="cell-left"><i class="cell-icon">*</i>家庭所属街道（镇）：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.familyStreet" class="cell-input" autocomplete="off" required/></div>
            </div>

            <div class="cell-item">
                <div class="cell-left">警署：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.townPoliceStation" class="cell-input" autocomplete="off" /></div>
            </div>

            <div class="cell-item">
                <div class="cell-left">本人住址所在省：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.addressProvince" class="cell-input" autocomplete="off" /></div>
            </div>

            <div class="cell-item">
                <div class="cell-left"><i class="cell-icon">*</i>本人住址所在市：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.addressCity" class="cell-input" autocomplete="off" required/></div>
            </div>

            <div class="cell-item">
                <div class="cell-left"><i class="cell-icon">*</i>本人住址所在县：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.addressCounty" class="cell-input" autocomplete="off" required/></div>
            </div>

            <div class="cell-item">
                <div class="cell-left">本人住址：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.address" class="cell-input" autocomplete="off" /></div>
            </div>

            <div class="cell-item">
                <div class="cell-left"><i class="cell-icon">*</i>家庭特殊情况：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.specialFamilyCircumstances" class="cell-input" autocomplete="off" required/></div>
            </div>

            <div class="cell-item">
                <div class="cell-left">是否知青子女：</div>
                <label class="cell-right">
                    <input type="checkbox" class="m-switch-old" v-model="shStudent.educatedChildren" autocomplete="off"/>
                    <span class="m-switch"></span>
                </label>
            </div>

            <div class="cell-item">
                <div class="cell-left">健康状况：</div>
                <label class="cell-right cell-arrow" >
                    <select class="cell-select" v-model="shStudent.healthCondition" id="health_status_Id">

                    </select>
                </label>
            </div>

            <div class="cell-item">
                <div class="cell-left">血型：</div>
                <label class="cell-right cell-arrow" >
                    <select class="cell-select" v-model="shStudent.bloodType" id="blood_type_Id">

                    </select>
                </label>
            </div>

            <div class="cell-item">
                <div class="cell-left">银行卡号：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.bankCard" class="cell-input" autocomplete="off" /></div>
            </div>

            <div class="cell-item">
                <div class="cell-left">录取通知书邮递编号：</div>
                <div class="cell-right"><input type="text" v-model="shStudent.postalCodes" class="cell-input" autocomplete="off" /></div>
            </div>


            <div class="cell-item">
                <div class="cell-left">港澳台侨：</div>
                <label class="cell-right cell-arrow" >
                    <select class="cell-select" v-model="shStudent.emigrantcode" id="gatq_Id">

                    </select>
                </label>
            </div>
            <div class="cell-item">
                <div class="cell-left"><i class="cell-icon">*</i>户口性质：</div>
                <label class="cell-right cell-arrow" >
                    <select class="cell-select" v-model="shStudent.householdRegistrationType" id="household_Id">

                    </select>
                </label>
            </div>
            <div class="cell-item">
                <label class="cell-right cell-arrow">
                    <select class="cell-select">
                        <option value="">支付方式</option>
                        <option value="1">支付宝</option>
                        <option value="2">微信</option>
                        <option value="3">财付通</option>
                    </select>
                </label>
            </div>

        </div>

        <div class="m-button">
            <button type="button" class="btn-block btn-primary" @click="saveOrUpdate" id="J_ShowActionSheet">提交</button>
        </div>
        </form>
    </section>
</section>
<script id="J_ListHtml" type="text/html">
    {{if isAdmin}}
   <!-- <select class="cell-select" v-model="{{modelName}}"  {{isRequired}} >-->
        <option value="">请选择{{labelName}}</option>
        {{each list as codeEntity i}}
        <option value="{{codeEntity.id}}">{{codeEntity.name}}</option>
        {{/each}}
    <!--</select>-->
    {{/if}}
</script>
<script src="../resources/path/build/js/fastclick.js"></script>
<script src="../resources/path/build/js/template.js"></script>
<script src="../resources/path/build/js/jquery-3.1.1.min.js"></script>
<script src="http://static.ydcss.com/uploads/ydui/ydui.citys.js"></script>
<script src="../resources/path/build/js/ydui.js"></script>
<script>
    var $address = $('#province');
    $address.citySelect();
    $address.on('click', function () {
        $address.citySelect('open');
    });

    $address.on('done.ydui.cityselect', function (ret) {
        /* 省：ret.provance */
        /* 市：ret.city */
        /* 县：ret.area */
        $(this).val(ret.provance);
     //   $(this).val(ret.provance + ' ' + ret.city + ' ' + ret.area);
    });
</script>
<script>
    !function (win, $) {
        var now = new Date(),
            year = now.getFullYear(),
            month = ((now.getMonth() + 1) > 9) ? (now.getMonth() + 1) : ("0" + (now.getMonth() + 1)),
            date = translate(now.getDate()),
            hour = translate(now.getHours()),
            minute = translate(now.getMinutes()),
            second = translate(now.getSeconds());

        function translate(prop) {
            if (prop <= 9) {
                return "0" + prop;
            } else {
                return prop
            }
        }
        var dateString = year + "-" + month + "-" + date;

        var $target = $('#nativePlace');
        $target.citySelect();
        $target.on('click', function (event) {
            event.stopPropagation();  //阻止事件传播
       //   event.preventDefault(); 阻止事件的默认行为
            //         $('#nativePlace').blur();
            $target.citySelect('open');
        },{passive: true});

        $target.on('done.ydui.cityselect', function (ret) {
            /* 省：ret.provance */
            /* 市：ret.city */
            /* 县：ret.area */
            $(this).val(ret.provance + ' ' + ret.city + ' ' + ret.area);
        });


        var apiDomain = 'http://183.195.133.44:83';
        //       var apiDomain = 'http://183.195.133.44:81';
        var url = apiDomain + '/app/getCodeByMark/';
        var arr = ['sex', 'certificate_type', 'marital_status', 'nation', 'policital_status', 'source_country', 'health_status', 'blood_type', 'gatq', 'household'];
        function getCode(code) {
            $.ajax({
                url: url + code,
                type: 'GET',
                async: false,
                dataType: 'json',//传递给请求处理程序或页面的,用以获得jsonp回调函数名的参数名(默认为callback)
                success: function (ret) {
                    if (ret.code == 0) {
                        var label_title = showLabel(code).split(":")[0];
                        var isRequired = showLabel(code).split(":")[1];
                        var modelName = showLabel(code).split(":")[2];
                        var data = {
                            isAdmin: true,
                            labelName: label_title,
                            list: ret.codeEntitys,
                            isRequired: isRequired,
                            modelName: modelName
                        };
                        var html = template('J_ListHtml', data);
                        $('#' + code + '_Id').append(html);
                        if (isRequired != "") {
                            $('#' + code + '_Id').attr("required", "true");
                        }
                    }
                },
                error: function (ret) {
                    alert("服务器连接失败");
                }
            });
        }

        function showLabel(labelInfo) {
            var label_title = "", required= "", modelName = "";
            switch (labelInfo) {
                case 'sex':
                    label_title = "性别";
                    required = "required";
                    modelName = "shStudent.sex";
                    break;
                case 'certificate_type':
                    label_title = "证件类型";
                    required = "required";
                    modelName = "shStudent.certificateType";
                    break;
                case 'marital_status':
                    label_title = "婚姻状况";
                    required = "";
                    modelName = "shStudent.maritalStatus";
                    break;
                case 'nation':
                    label_title = "民族";
                    required = "";
                    modelName = "shStudent.nation";
                    break;
                case 'policital_status':
                    label_title = "政治面貌";
                    required = "";
                    modelName = "shStudent.politicalStatus";
                    break;
                case 'source_country':
                    label_title = "来源国别";
                    required = "";
                    modelName = "shStudent.sourceCountry";
                    break;
                case 'health_status':
                    label_title = "健康状况";
                    required = "";
                    modelName = "shStudent.healthCondition";
                    break;
                case 'blood_type':
                    label_title = "血型";
                    required = "";
                    modelName = "shStudent.bloodType";
                    break;
                case 'gatq':
                    label_title = "港澳台侨";
                    required = "";
                    modelName = "shStudent.emigrantcode";
                    break;
                case 'household':
                    label_title = "入学前户口性质";
                    required = "required";
                    modelName = "shStudent.householdRegistrationType";
                    break;
            }
            return label_title + ':' + required + ":" + modelName;
        }

        //根据$studentId判断登录用户的信息是来自远程库还是本地库
        /*var $studentId = localStorage.getItem("studentId");
        if ($studentId) {
            for (let i of arr) {
                getCode(i);
            }
        } else {
            win.YDUI.dialog.toast('很抱歉，用户登录信息已过期，请重新登录', 'error', 3000, function () {
                localStorage.clear();
                window.location = 'register_manager.html';
            });
        }*/
    }(window, jQuery);

    var dialog = window.YDUI.dialog;
    var $shStudent = JSON.parse(localStorage.getItem("shStudent"));
    console.log($shStudent);
    var vm = new Vue({
        el:'#rrapp',
        editor: null,
        data:{
            shStudent: {}
        },
        mounted: function() {
            //这个是钩子函数
            //如果cartView函数要执行，必须先执行钩子函数
            //这个钩子函数完成了对cratView函数的调用
            //应该注意的是，使用mounted 并不能保证钩子函数中的 this.$el 在 document 中。为此还应该引入Vue.nextTick/vm.$nextTick
            this.$nextTick(function () {
                this.getSelectInfo();
            })

        },
        methods: {
            saveOrUpdate: function (event) {
                var url = vm.shStudent.id == null ? 'http://localhost:81/' + "app/shStudentSave" : 'http://localhost:81/' + "app/shStudentUpdate";
          //      var url ='http://localhost:81/' + "app/shStudentSave";
                vm.shStudent['homeAddress'] = $shStudent.homeAddress;
                $.ajax({
                    type: "POST",
                    url: url,
                    data: JSON.stringify(vm.shStudent),
                    dataType: 'json',
                    async: false,
                    contentType:'application/json;charset=UTF-8',
                    success: function(r){
                        if(r.code == 0){
                            /* 正确提示框 */
                            localStorage.setItem("studentId", r.uuid);
                            vm.shStudent.id = r.uuid;
                            dialog.toast(r.msg, 'success', 1000, function () {
                                //重新缓存个人信息
                                var shStudentEntity = JSON.stringify(r.shStudentEntity);
                                localStorage.setItem('shStudent', JSON.stringify(r.shStudentEntity));
                                $shStudent = shStudentEntity;
                            });
                        }else{
                            dialog.toast(r.msg, 'error', 1000, function () {
                                dialog.alert('请检查后，重新提交!');
                            });
                        }
                    }
                });
            },
            getInfo: function(id){
                var local_shStudent = JSON.parse(localStorage.getItem("shStudent"));
                if (jQuery.isEmptyObject(local_shStudent)) {
                    $.ajax({
                        url: 'http://183.195.133.44:83' + "/app/getStudentInfoByCard/" + $idCard,
                        type: "POST",
                        dataType: "json",
                        async: false,
                        contentType:'application/json;charset=UTF-8',
                        success: function (data) {
                            console.log(data);
                            if (data.code == 0) {
                                localStorage.setItem("shStudent", data.shStudent);
                                vm.shStudent = data.shStudent;
                            } else {
                                dialog.alert('很抱歉，数据验证失败，请重新尝试！');
                            }
                        }
                    });
                } else {
                    vm.shStudent = local_shStudent;
                }
            },
            getSelectInfo: function () {
                var apiDomain = 'http://183.195.133.44:83';
                //       var apiDomain = 'http://183.195.133.44:81';
                var url = apiDomain + '/app/getCodeByMark/';
                var arr = ['sex', 'certificate_type', 'marital_status', 'nation', 'policital_status', 'source_country', 'health_status', 'blood_type', 'gatq', 'household'];
                function getCode(code) {
                    $.ajax({
                        url: url + code,
                        type: 'GET',
                        async: false,
                        dataType: 'json',//传递给请求处理程序或页面的,用以获得jsonp回调函数名的参数名(默认为callback)
                        success: function (ret) {
                            if (ret.code == 0) {
                                var label_title = showLabel(code).split(":")[0];
                                var isRequired = showLabel(code).split(":")[1];
                                var modelName = showLabel(code).split(":")[2];
                                var data = {
                                    isAdmin: true,
                                    labelName: label_title,
                                    list: ret.codeEntitys,
                                    isRequired: isRequired,
                                    modelName: modelName
                                };
                                var html = template('J_ListHtml', data);
                                $('#' + code + '_Id').append(html);
                                if (isRequired != "") {
                                    $('#' + code + '_Id').attr("required", "true");
                                }
                            }
                        },
                        error: function (ret) {
                            alert("服务器连接失败");
                        }
                    });
                }

                function showLabel(labelInfo) {
                    var label_title = "", required= "", modelName = "";
                    switch (labelInfo) {
                        case 'sex':
                            label_title = "性别";
                            required = "required";
                            modelName = "shStudent.sex";
                            break;
                        case 'certificate_type':
                            label_title = "证件类型";
                            required = "required";
                            modelName = "shStudent.certificateType";
                            break;
                        case 'marital_status':
                            label_title = "婚姻状况";
                            required = "";
                            modelName = "shStudent.maritalStatus";
                            break;
                        case 'nation':
                            label_title = "民族";
                            required = "";
                            modelName = "shStudent.nation";
                            break;
                        case 'policital_status':
                            label_title = "政治面貌";
                            required = "";
                            modelName = "shStudent.politicalStatus";
                            break;
                        case 'source_country':
                            label_title = "来源国别";
                            required = "";
                            modelName = "shStudent.sourceCountry";
                            break;
                        case 'health_status':
                            label_title = "健康状况";
                            required = "";
                            modelName = "shStudent.healthCondition";
                            break;
                        case 'blood_type':
                            label_title = "血型";
                            required = "";
                            modelName = "shStudent.bloodType";
                            break;
                        case 'gatq':
                            label_title = "港澳台侨";
                            required = "";
                            modelName = "shStudent.emigrantcode";
                            break;
                        case 'household':
                            label_title = "入学前户口性质";
                            required = "required";
                            modelName = "shStudent.householdRegistrationType";
                            break;
                    }
                    return label_title + ':' + required + ":" + modelName;
                }

                //根据$studentId判断登录用户的信息是来自远程库还是本地库
                var $studentId = localStorage.getItem("studentId");
                if ($studentId) {
                    for (let i of arr) {
                        getCode(i);
                    }
                } else {
                    window.YDUI.dialog.toast('很抱歉，用户登录信息已过期，请重新登录', 'error', 3000, function () {
                        localStorage.clear();
                        window.location = 'register_manager.html';
                    });
                }
            }
        }
    });
    vm.shStudent = $shStudent;

</script>
</body>
</html>